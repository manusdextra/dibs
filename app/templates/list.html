{% extends "base.html" %}
{% from "form.html" import formbase %}

{% block title %}dibs - {{ currentlist.title }}{% endblock %}
{% block head %} {{ super() }} {% endblock %} 
{% block page_content %}
<main class="container">
  <hgroup>
    <h1>
      {{ currentlist.title }}
    </h1>
    <h2>by <a href="{{ url_for("main.profile", username=currentlist.author.username) }}">{{ currentlist.author.username }}</a></h2>
  </hgroup>

  <section>

  {% if items %}
  <table role="grid">
    <thead>
      <tr>
        <td>#</td>
        <td>Title</td>
        <td>Description</td>
        <td>Category</td>
        <td></td>
      </tr>
    </thead>
    <tbody>
      {% for item in items %}
      <tr>
        <td>{{ loop.index }}</td>
        <td>
          {% if item.link %}
          <a href="https://{{ item.link|safe }}">{{ item.name }}</a>
          {% else %}
          {{ item.name }}
          {% endif %}
        </td>
        <td>{{item.description}}</td>
        <td>{{item.category | last}}</td>
        <td>
          {% if current_user.role_id == 2 %}
          <a href="{{ url_for("main.delete_item", list_id=currentlist.id, item_id=item.id )}}">
            [ delete? ]</a>
          {% endif %}
        </td>
        {% endfor %}
    </tbody>
  </table>
  {#
            {% if current_user.id != currentlist.author.id %}
                {% if comments %}
              <ul>
                {% for comment in comments %}
                  <blockquote>{{ comment.body }}<footer><cite>â€”{{ comment.author | capitalize }}</cite></footer></blockquote>
                {% endfor %}
              </ul>
                {% endif %}
            {% endif %}
    #}

  {% else %}
  <p>
  This list is empty.
  </p>
  {% endif %}

  {% if author == current_user %}
  </section>
  <section>
    <div>
      <h3>
      Add items
      </h3>
      {{ formbase(itemform) }}
    </div>
  </section>
  {% endif %}

  {% if current_user.is_administrator() %}
  <a href="{{url_for("main.delete_list", list_id=currentlist.id)}}">Delete this list</a>
  {% endif %}
</main>
{% endblock %}
